# Task 7.1: Create React + Tailwind UI

## Persona
You are a frontend developer building a minimal but polished chat UI for the Waypoint customer service co-pilot. You prioritize clean, functional design with good UX patterns for a Q&A interface.

## Context

### Project State
- **Backend Complete**: Express API running at `http://localhost:3000`
- **API Endpoint**: `POST /api/query` accepts `{ "query": "..." }` and returns structured response
- **Health Check**: `GET /api/health` returns `{ "status": "ok", ... }`

### API Response Format (Actual from Backend)
```json
{
  "answer": "For sea freight export from Singapore...",
  "citations": [
    {
      "raw": "[Singapore Export Procedures > Required Documents]",
      "title": "Singapore Export Procedures",
      "section": "Required Documents",
      "position": 45,
      "matched": true,
      "sourceUrls": ["https://www.customs.gov.sg/..."],
      "docId": "01_regulatory/singapore_export.md",
      "score": 0.82,
      "fullTitle": "Singapore Export Procedures Guide"
    }
  ],
  "sourcesMarkdown": "\n---\n**Sources:**\n1. [Singapore Export Procedures](https://...)",
  "confidence": {
    "level": "High",
    "reason": "3 relevant sources with 2 citations"
  },
  "metadata": {
    "query": "What documents for export?",
    "chunksRetrieved": 10,
    "chunksUsed": 4,
    "model": "llama-3.1-8b-instant",
    "usage": { "prompt_tokens": 1200, "completion_tokens": 350 },
    "latency": {
      "retrievalMs": 450,
      "generationMs": 1800,
      "citationMs": 50,
      "totalMs": 2340
    }
  }
}
```

**Key Fields for UI:**
- `answer` - Main response text to display
- `citations[].title` - Document title
- `citations[].section` - Section within document (may be null)
- `citations[].sourceUrls[0]` - Primary URL (array, use first)
- `citations[].matched` - Only show if true
- `confidence.level` - "High", "Medium", or "Low"
- `confidence.reason` - Explanation text
- `metadata.chunksRetrieved` / `chunksUsed` - For stats display
- `metadata.latency.totalMs` - Total response time

### References
- Roadmap: `docs/01_implementation_roadmap.md` (Task 7.1)
- API Implementation: `src/index.js`
- Pipeline Response: `src/services/pipeline.js`

### Dependencies
- ✅ Task 6.2: Express API (Complete)
- ✅ Task 6.3: E2E API Test (Complete)

## Task

### Objective
Create a React + Tailwind CSS frontend that provides a clean, professional chat interface for the Waypoint RAG system.

### Requirements

#### 1. Project Setup (Exact Commands)

**Step 1: Scaffold Vite + React project**
```bash
cd pilot_phase1_poc/03_rag_pipeline
npm create vite@latest client -- --template react
cd client
```

**Step 2: Install Tailwind CSS v3 with PostCSS**
```bash
npm install -D tailwindcss@3 postcss autoprefixer
npx tailwindcss init -p
```

**Step 3: Install react-markdown for answer rendering**
```bash
npm install react-markdown
```

**Step 4: Configure Vite proxy for API**

Create/update `vite.config.js`:
```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
      },
    },
  },
})
```

**Step 5: Configure Tailwind content paths**

Update `tailwind.config.js`:
```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
```

**Step 6: Add Tailwind directives to CSS**

Replace `src/index.css`:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

#### 2. Component Structure
```
client/
├── src/
│   ├── App.jsx              # Main app with state management
│   ├── main.jsx             # Entry point (Vite default)
│   ├── index.css            # Tailwind directives
│   ├── components/
│   │   ├── QueryInput.jsx   # Search box with submit button
│   │   ├── Response.jsx     # Answer display with markdown
│   │   ├── Citations.jsx    # Clickable citation list
│   │   ├── Confidence.jsx   # Confidence level indicator
│   │   └── Loading.jsx      # Loading spinner/skeleton
│   └── api/
│       └── query.js         # API client with fetch
├── index.html
├── package.json
├── tailwind.config.js
├── postcss.config.js        # Auto-generated by tailwindcss init -p
└── vite.config.js
```

#### 3. Component Specifications

**QueryInput.jsx**
- Text input with placeholder "Ask about shipping, customs, carriers..."
- Submit button (or Enter key to submit)
- Disabled state while query is processing
- Clear button to reset input
- Tailwind classes for states:
  ```jsx
  className="w-full px-4 py-2 border border-slate-300 rounded-lg
    focus:outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500
    disabled:bg-slate-50 disabled:text-slate-500 disabled:border-slate-200"
  ```

**Response.jsx**
- Use `react-markdown` to render answer with formatting:
  ```jsx
  import Markdown from 'react-markdown'

  <Markdown>{answer}</Markdown>
  ```
- Show "Ask a question to get started" state initially
- Handle error states with clear message
- Style prose content with Tailwind typography

**Citations.jsx**
- List of source citations below response
- Filter to show only `matched: true` citations
- Each citation shows: title, section (if available)
- External links open in new tab (`target="_blank" rel="noopener noreferrer"`)
- Internal documents (empty `sourceUrls`) show "(Internal)" badge
- Example structure:
  ```jsx
  // Note: sourceUrls is an array, use first URL
  const url = citation.sourceUrls?.[0];

  {url ? (
    <a href={url} target="_blank" rel="noopener noreferrer"
       className="text-sky-600 hover:text-sky-800 hover:underline">
      {citation.title} {citation.section && `› ${citation.section}`}
    </a>
  ) : (
    <span className="text-slate-600">
      {citation.title} {citation.section && `› ${citation.section}`}
      <span className="ml-2 text-xs bg-slate-100 px-1.5 py-0.5 rounded">Internal</span>
    </span>
  )}
  ```

**Confidence.jsx**
- Visual indicator of confidence level (High/Medium/Low)
- Color-coded badges using Tailwind colors:
  - High: `bg-emerald-100 text-emerald-800`
  - Medium: `bg-amber-100 text-amber-800`
  - Low: `bg-rose-100 text-rose-800`
- Show reason text below the badge

**Loading.jsx**
- Animated spinner using Tailwind `animate-spin`
- Show after 200ms delay (avoid flash for fast responses)
- Implementation pattern:
  ```jsx
  const [showSpinner, setShowSpinner] = useState(false)
  useEffect(() => {
    const timer = setTimeout(() => setShowSpinner(true), 200)
    return () => clearTimeout(timer)
  }, [])
  ```

#### 4. API Client (`src/api/query.js`)
```javascript
export async function submitQuery(query, signal) {
  const response = await fetch('/api/query', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ query }),
    signal, // AbortController signal for cleanup
  })

  if (!response.ok) {
    const error = await response.json().catch(() => ({}))
    throw new Error(error.message || `Request failed: ${response.status}`)
  }

  return response.json()
}
```

#### 5. State Management Pattern
```jsx
// In App.jsx
const [query, setQuery] = useState('')
const [response, setResponse] = useState(null)
const [loading, setLoading] = useState(false)
const [error, setError] = useState(null)

const handleSubmit = async (queryText) => {
  const controller = new AbortController()
  setLoading(true)
  setError(null)

  try {
    const result = await submitQuery(queryText, controller.signal)
    setResponse(result)
  } catch (err) {
    if (err.name !== 'AbortError') {
      setError(err.message)
    }
  } finally {
    setLoading(false)
  }
}
```

#### 6. Styling Requirements

**Color Palette (Tailwind built-in)**
- Primary: `sky-500`, `sky-600`, `sky-700` (blues)
- Neutral: `slate-50` through `slate-900` (grays)
- Success: `emerald-*` (confidence high)
- Warning: `amber-*` (confidence medium)
- Error: `rose-*` (confidence low, errors)

**Responsive Design (Mobile-First)**
- Unprefixed classes = all screen sizes (mobile base)
- `sm:` = 640px and up
- `md:` = 768px and up
- `lg:` = 1024px and up
- Example: `class="px-4 md:px-8 lg:max-w-4xl lg:mx-auto"`

**Layout**
- Max width container: `max-w-3xl mx-auto`
- Padding: `px-4 py-6 md:py-8`
- Card-like response area: `bg-white rounded-lg shadow-sm border border-slate-200 p-4`

#### 7. UX Requirements
- Focus input on page load using `useRef` + `useEffect`
- Show loading state immediately on submit (spinner after 200ms)
- Smooth transition when response appears
- Error messages are clear: "Unable to process query. Please try again."
- Citations visually distinct: smaller text, muted color, icon prefix
- Keyboard accessible: Enter to submit, Tab navigation

### Constraints
- No additional UI libraries (Material, Chakra, etc.) - Tailwind only
- Keep bundle size minimal (~150KB gzipped target)
- No authentication/login required
- Single-page app (no routing needed)
- Use `react-markdown` for markdown rendering (already in deps)

### Acceptance Criteria
- [ ] `npm create vite@latest client -- --template react` runs successfully
- [ ] Tailwind CSS classes render correctly (test with `bg-sky-500`)
- [ ] Vite proxy forwards `/api/*` requests to port 3000
- [ ] Can type query and submit with button or Enter key
- [ ] Loading spinner appears after 200ms delay
- [ ] Response displays with markdown formatting (headers, lists, bold)
- [ ] Citations render as clickable links opening in new tab
- [ ] Confidence badge shows correct color for High/Medium/Low
- [ ] Error state displays user-friendly message
- [ ] Layout is responsive (test at 375px and 1024px widths)
- [ ] `npm run dev` starts dev server on port 5173
- [ ] `npm run build` produces production build without errors

## Format

### Code Style
- Functional components with hooks
- Destructured props
- Single responsibility per component
- No inline styles - Tailwind classes only
- Comments only where logic is non-obvious

### File Structure
Create files in the order listed in section 2.

### Validation Commands
```bash
cd pilot_phase1_poc/03_rag_pipeline/client

# Install and start
npm install
npm run dev

# Test in browser at http://localhost:5173
# 1. Verify Tailwind works: check if styles load
# 2. Submit query: "What documents for Indonesia export?"
# 3. Verify response displays with citations
# 4. Test error: stop backend, submit query, verify error message

# Production build
npm run build
ls -la dist/  # Verify build output
```

### Output
1. All files in `client/` directory
2. Brief testing notes confirming each acceptance criterion
3. Note any issues encountered and workarounds

### Example Query Flow
1. User types: "What documents are needed for Indonesia export?"
2. Clicks Submit or presses Enter
3. Button shows disabled state, spinner appears after 200ms
4. After ~2-3 seconds, response appears with:
   - Formatted answer (markdown rendered to HTML)
   - Citations list (filter where `matched: true`)
   - Confidence badge with level and reason
   - Optional stats: "Retrieved 10 chunks, used 4 • 2.3s"
5. User can type new query and search again

### Handling Edge Cases
- **No citations**: Don't show citations section if `citations.filter(c => c.matched).length === 0`
- **Low confidence**: Show amber/rose badge with reason text
- **Empty answer**: Show "No relevant information found" message
- **API error**: Show user-friendly error with retry option
